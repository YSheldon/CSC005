---
layout: post
title: Turla Mosquito: A shift towards more generic tools
date: 2018-05-22 17:02:39
tourl: https://www.welivesecurity.com/2018/05/22/turla-mosquito-shift-towards-generic-tools/
tags: [Exploitation,frame,attack]
---
ESETç ”ç©¶äººå‘˜å·²ç»è§‚å¯Ÿåˆ°è‡­åæ˜­è‘—çš„é—´è°ç»„ç»‡è¿åŠ¨çš„é‡å¤§å˜åŒ–ttttttttttttttt Turlaæ˜¯ä¸€ä¸ªè‡­åæ˜­è‘—çš„é—´è°ç»„ç»‡ï¼Œå¹¶å·²ç»æ´»è·ƒäº†è‡³å°‘åå¹´ã€‚åœ¨2008ï¼Œå½“Turlaè¿åäº†æˆ‘ä»¬2018å¹´3æœˆçš„2018å¹´1æœˆå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°äº†è¿™é¡¹è¿åŠ¨çš„é‡å¤§å˜åŒ–ï¼šå®ƒç°åœ¨åˆ©ç”¨å¼€æºå¼€å‘æ¡†æ¶Meta SpasTITï¼Œç„¶åæ”¾å¼ƒå®šåˆ¶èšŠå¸åé—¨ã€‚è¿™å·²ç»ä¸æ˜¯Turlaç¬¬ä¸€æ¬¡ä½¿ç”¨é€šç”¨å·¥å…·äº†ã€‚åœ¨è¿‡å»ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°è¯¥ç»„ä½¿ç”¨å¼€æºå¯†ç è½¬å‚¨å™¨ï¼Œå¦‚MIMIKATZã€‚ç„¶è€Œï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™æ˜¯Turlaç¬¬ä¸€æ¬¡ä½¿ç”¨Meta SasPITä½œä¸ºç¬¬ä¸€é˜¶æ®µçš„åé—¨ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå®ƒè‡ªå·±çš„å·¥å…·ï¼Œå¦‚æˆ‘ä»¬æ‰€æè¿°çš„ï¼Œå½“ç”¨æˆ·é€šè¿‡HTTPä»GET.AdObjoä¸‹è½½Flashå®‰è£…ç¨‹åºæ—¶ï¼Œä¼šå‘ç”ŸæŠ˜è¡·ã€‚åœ¨ç«¯æœºå’ŒAdobeæœåŠ¡å™¨ä¹‹é—´çš„èŠ‚ç‚¹ä¸Šæˆªè·æµé‡ï¼Œå…è®¸TurLAæ“ä½œäººå‘˜ç”¨ç‰¹æ´›ä¼ŠåŒ–çš„ç‰ˆæœ¬æ›¿æ¢åˆæ³•çš„Flashå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸‹é¢çš„å›¾åƒæ˜¾ç¤ºäº†ç†è®ºä¸Šå¯ä»¥æˆªè·äº¤é€šçš„ä¸åŒç‚¹ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ç›¸ä¿¡ç¬¬äº”ç§å¯èƒ½æ€§è¢«æ’é™¤åœ¨å¤–ï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥ï¼ŒAdobeï¼Akamaiå¹¶æ²¡æœ‰å—åˆ°æŸå®³ã€‚å³ä½¿æˆ‘ä»¬æ— æ³•åŠæ—¶å‘ç°äº¤é€šæ‹¦æˆªï¼Œæˆ‘ä»¬è¿˜æ˜¯å‘ç°äº†ä¸€ä¸ªæ–°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒåœ¨2018å¹´3æœˆåˆä»è¢«æ¨¡æ‹Ÿä¸ºPã€‚æˆ‘ä»¬å®šæœŸè·Ÿè¸ªç‰¹æ‹‰æ´»åŠ¨çš„è‰ºæœ¯ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°èšŠå­è¿åŠ¨çš„ä¸€äº›å˜åŒ–ã€‚å³ä½¿ä»–ä»¬æ²¡æœ‰åˆ©ç”¨çªç ´æ€§çš„æŠ€æœ¯ï¼Œè¿™åœ¨TurLAçš„æˆ˜æœ¯ã€æŠ€æœ¯å’Œç¨‹åºï¼ˆTTPSï¼‰ä¸­æ˜¯ä¸€ä¸ªé‡å¤§çš„è½¬å˜ã€‚ä»¥å‰ï¼Œå¦¥åçš„é“¾æ¡æ˜¯ä¸€ä¸ªå‡çš„Flashå®‰è£…ç¨‹åºï¼Œä¸¢å¼ƒä¸€ä¸ªåŠ è½½å™¨å’Œä¸»åé—¨ã€‚ä¸‹é¢çš„å›¾æ€»ç»“äº†è¿™ä¸ªè¿‡ç¨‹ã€‚æœ€è¿‘ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°äº†æœ€ç»ˆåé—¨è¢«ä¸¢å¼ƒçš„æ–¹å¼çš„æ”¹å˜ã€‚TurLAçš„æˆ˜å½¹ä»ç„¶ä¾èµ–äºä¸€ä¸ªä¼ªé€ çš„Flashå®‰è£…ç¨‹åºï¼Œä½†æ˜¯ï¼Œå®ƒä¸æ˜¯ç›´æ¥ä¸¢å¼ƒä¸¤ä¸ªæ¶æ„DLLï¼Œè€Œæ˜¯æ‰§è¡Œä¸€ä¸ªMeta ASSPLITå¤–å£³ä»£ç ï¼Œå¹¶ä»è°·æ­ŒDeadä¸‹è½½ï¼Œæˆ–è€…åˆæ³•çš„Flashå®‰è£…ç¨‹åºã€‚ç„¶åï¼ŒSeelCuç ä¸‹è½½MeTePrterï¼Œè¿™æ˜¯å…¸å‹çš„ï¼Œå› ä¸ºæ­£åœ¨ä½¿ç”¨Meta asPrimItï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çŒœæµ‹æ“ä½œå‘˜æ‰‹åŠ¨æ§åˆ¶å¼€å‘è¿‡ç¨‹ã€‚æ”»å‡»çš„æ—¶é—´æ¡†æ¶ç›¸å¯¹è¾ƒçŸ­ï¼Œå› ä¸ºæœ€ç»ˆçš„åé—¨åœ¨å¦¥åå°è¯•å¼€å§‹çš„ä¸‰ååˆ†é’Ÿå†…è¢«ä¸¢å¼ƒã€‚SeelCuç æ˜¯ä¸€ä¸ªå…¸å‹çš„Meta ASTIGITå¤–å£³ä»£ç ï¼Œä¸€æ—¦è¢«è§£ç ï¼Œå®ƒå°±åœ¨HTTPS://20923.9115[[ 91 ] /6OHEJ ]ä¸Šæ¥è§¦å®ƒçš„CCã€‚å®ƒæŒ‡å¯¼ä¸‹è½½é¢å¤–çš„è´å£³ä»£ç ã€‚åŸºäºæˆ‘ä»¬çš„é¥æµ‹æŠ€æœ¯ï¼Œæˆ‘ä»¬ç¡®å®šäº†ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯METPREPROTERã€‚è¿™ä¸ªIPåœ°å€å·²ç»è¢«ç§°ä¸ºä»¥å‰è§è¿‡çš„èšŠå­CCé¢†åŸŸï¼Œå¿ƒç†å­¦åšå®¢ã€‚EZUA[.COMï¼Œåœ¨2017å¹´10æœˆè§£å†³äº†å®ƒã€‚æœ€åï¼Œå‡Flashå®‰è£…ç¨‹åºä»è°·æ­Œé©±åŠ¨å™¨URLä¸‹è½½åˆæ³•çš„Adobeå®‰è£…ç¨‹åºï¼Œå¹¶æ‰§è¡Œå®ƒæ¥è®©ç”¨æˆ·è®¤ä¸ºæ‰€æœ‰çš„ä¿®æ”¹éƒ½æ˜¯æ­£ç¡®çš„ã€‚é™¤äº†æ–°çš„Flash Flashå®‰è£…ç¨‹åºå’ŒMeTePrterä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è§‚å¯Ÿåˆ°äº†å…¶ä»–å‡ ç§å·¥å…·çš„ä½¿ç”¨ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†è¿‡å»å‡ ä¸ªæœˆTurLAèšŠå­è¿åŠ¨çš„æ¼”å˜ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„ä¸»è¦å˜åŒ–æ˜¯ä½¿ç”¨Meta SasPITï¼Œä¸€ä¸ªå¼€æºæ¸—é€æµ‹è¯•é¡¹ç›®ï¼Œä½œä¸ºå®šåˆ¶èšŠå¸åé—¨çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚è¿™å¯èƒ½æ˜¯é˜²å¾¡è€…åœ¨æ¶‰åŠTurLAçš„æ”»å‡»ä¸­æ‰§è¡Œäº‹ä»¶å“åº”çš„æœ‰ç”¨ä¿¡æ¯ã€‚ã€”1ã€•è¯ºå°”é¡¿ï¼Œå†›äº‹è®¡ç®—æœºæ”»å‡»è¯å®ï¼Œçº½çº¦æ—¶æŠ¥ï¼Œ25ï¼Œ08ï¼Œ2010ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šHTTPS://www. NyTim.COM/2010/08/26/TeaMy/26Cyr.HTMLï¼Ÿrï¼1ReFï¼æŠ€æœ¯ã€‚[è®¿é—®09ï¼Œ04ï¼Œ2018 ]ã€‚[ 2 ] MELANIï¼Œå…³äºåœ¨RuAGçš„ç½‘ç»œé—´è°ä¸­ä½¿ç”¨çš„æ¶æ„è½¯ä»¶çš„æŠ€æœ¯æŠ¥å‘Šï¼Œ23 05 2016ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šhttp://www. Melii.admin .CH/Melii/En/home /dokime/æŠ¥å‘Š/æŠ€æœ¯æŠ¥å‘Š/æŠ€æœ¯-RePr.APTTA CaseSuRua.htmlã€‚ï¼ˆ3ï¼‰ESETï¼Œä¸œæ¬§å¤–äº¤å®˜è¢«TuraèšŠå’¬ä¼¤ï¼ŒESETï¼Œ01ï¼Œ2018ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šhttp://www-WelveSeury.COM/WPå†…å®¹/ä¸Šä¼ / 2018 / 01 / EsTyTuraLaMaul.pdfã€‚[ 4 ] ESETï¼ŒèšŠåª’æŒ‡ç¤ºå™¨ï¼ŒESETï¼Œ09ï¼Œ01ï¼Œ2018ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šHTTPS://GITHUB.COM/ESET /æ¶æ„è½¯ä»¶IOC/æ ‘/ä¸»/ TurLAèšŠæŒ‡ç¤ºå™¨çš„å¦¥åã€‚ã€”5ã€•M. Tivadarï¼ŒC. Istrateï¼ŒMunTeandå’ŒA. Ardeleanï¼ŒPoPault APTï¼Œç¬¬01Ã—07ï¼Œ2016ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šhttp://labï¼ŒBITDeFund.COM/WPå†…å®¹/ä¸Šä¼ /ä¸‹è½½/ PoPoto APT/.[ 6 ]å…³äºMeta ASTIMIT MTEPRPRTERï¼Œ[åœ¨çº¿]ã€‚å¯ç”¨ï¼šhttp://www. fordyoSurviv.COM/METASPLIITé‡Šæ”¾/å…³äºMeTrPrExterï¼[ 7 ]é€šè¿‡è„šæœ¬RADEAR2æ‹†å¼€SkkATA GAI NaIï¼Œ08Ã—12 2015ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šhttp://rADAR.ä»Šå¤©/å¸–å­/è§£åŒ…SHIKATA GA-NI-Scriptè„šæœ¬RADARE2//ï¼ˆ8ï¼‰MeErPrExter /æº/æ‰©å±•/ PRIV/Server / LeaveT/ï¼ŒRAPID7ï¼Œ26ï¼Œ11ï¼Œ2013ã€‚[åœ¨çº¿]ã€‚å¯ç”¨ï¼šHTTPSE//GITHUBCOM/RAPID7/METPRETER/TRAE/Mask/Suxe/ExtExsS/Primuls/Struts
ESET researchers have observed a significant change in the campaign of the infamous espionage group tttttttttttttttTurla is a notorious espionage group, and has been active for at least ten years. It came to light in 2008, when Turla breached the Our January 2018 Starting in March 2018, we observed a significant change in the campaign: it now leverages the open source exploitation framework Metasploit before dropping the custom Mosquito backdoor. It is not the first time Turla has used generic tools. In the past, we have seen the group using open-source password dumpers such as Mimikatz. However, to our knowledge, this is the first time Turla has used Metasploit as a first stage backdoor, instead of relying on one of its own tools such as As described in our We showed that the compromise happens when the user downloads a Flash installer from get.adobe.com through HTTP. Traffic was intercepted on a node between the end machine and the Adobe servers, allowing Turla’s operators to replace the legitimate Flash executable with a trojanized version. The following image shows the different points where the traffic could in theory be intercepted. Please note that we believe the fifth possibility to be excluded, as, to the best of our knowledge, Adobe/Akamai was not compromised.Even though we were not able to spot traffic interception subsequently, we found a new executable that is still impersonating the At the beginning of March 2018, as part of our regular tracking of Turla’s activities, we observed some changes in the Mosquito campaign. Even though they did not make use of groundbreaking techniques, this is a significant shift in Turla’s Tactics, Techniques and Procedures (TTPs).Previously, the chain of compromise was a fake Flash installer dropping a loader and the main backdoor. The following figure summarizes the process.Recently, we observed a change in the way in which the final backdoor is dropped. Turla’s campaign still relies on a fake Flash installer but, instead of directly dropping the two malicious DLLs, it executes a Metasploit shellcode and drops, or downloads from Google Drive, a legitimate Flash installer. Then, the shellcode downloads a Meterpreter, which is a typical Because Metasploit is being used, we might also guess that an operator controls the exploitation process manually. The time frame of the attack was relatively short as the final backdoor was dropped within thirty minutes of the start of the compromise attempt.The shellcode is a typical Metasploit shellcode, protected using the Once the shellcode is decoded, it contacts its CC at https://209.239.115[.]91/6OHEJ, which directs the download of an additional shellcode. Based on our telemetry, we identified the next stage to be a Meterpreter. That IP address is already known as a previously seen Mosquito CC domain, psychology-blog.ezua[.]com, was resolving to it in October 2017.Finally, the fake Flash installer downloads a legitimate Adobe installer, from a Google Drive URL, and executes it to lull the user into thinking all went correctly.In addition to the new fake Flash installer and Meterpreter, we observed the use of several other tools.In this post, we have presented the evolutions of the Turla Mosquito campaign over the last few months. The major change we observed was the use of Metasploit, an open-source penetration testing project, as a first stage for the custom Mosquito backdoor. This might be useful information for defenders performing incident response on attacks involving Turla.[1] B. KNOWLTON, “Military Computer Attack Confirmed,” New York Times, 25 08 2010. [Online]. Available: https://www.nytimes.com/2010/08/26/technology/26cyber.html?_r=1ref=technology. [Accessed 09 04 2018].[2] MELANI, ” Technical Report about the Malware used in the Cyberespionage against RUAG,” 23 05 2016. [Online]. Available: https://www.melani.admin.ch/melani/en/home/dokumentation/reports/technical-reports/technical-report_apt_case_ruag.html.[3] ESET, “Diplomats in Eastern Europe bitten by a Turla mosquito,” ESET, 01 2018. [Online]. Available: https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf.[4] ESET, “Mosquito Indicators of Compromise,” ESET, 09 01 2018. [Online]. Available: https://github.com/eset/malware-ioc/tree/master/turla#mosquito-indicators-of-compromise.[5] M. Tivadar, C. Istrate, I. Muntean and A. Ardelean, “Pacifier APT,” 01 07 2016. [Online]. Available: https://labs.bitdefender.com/wp-content/uploads/downloads/pacifier-apt/.[6] “About the Metasploit Meterpreter,” [Online]. Available: https://www.offensive-security.com/metasploit-unleashed/about-meterpreter/.[7] “Unpacking shikata-ga-nai by scripting radare2,” 08 12 2015. [Online]. Available: http://radare.today/posts/unpacking-shikata-ga-nai-by-scripting-radare2/.[8] “meterpreter/source/extensions/priv/server/elevate/,” Rapid7, 26 11 2013. [Online]. Available: https://github.com/rapid7/meterpreter/tree/master/source/extensions/priv/server/elevate.tttttttttttttttttttttttttt