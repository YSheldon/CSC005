---
layout: post
title: CSS Is So Overpowered It Can Deanonymize Facebook Users
date: 2018-05-31 14:15:28
tourl: https://www.bleepingcomputer.com/news/security/css-is-so-overpowered-it-can-deanonymize-facebook-users/
tags: [attack]
---
æœ€è¿‘æ·»åŠ åˆ°å±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰Webæ ‡å‡†ä¸­çš„ä¸€äº›åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä»¥è‡³äºå®‰å…¨ç ”ç©¶äººå‘˜æ»¥ç”¨å®ƒä»¬ï¼Œå°†è®¿é—®è€…åŒ¿ååŒ–åˆ°æ¼”ç¤ºç«™ç‚¹ï¼Œå¹¶æ˜¾ç¤ºä»–ä»¬çš„è„¸è°±ç½‘ç”¨æˆ·åã€åŒ–èº«ï¼Œä»¥åŠå¦‚æœä»–ä»¬å–œæ¬¢è„¸è°±ç½‘çš„ç‰¹å®šç½‘é¡µã€‚æ”»å‡»å¯ä»¥å¸®åŠ©ä¸€äº›å¹¿å‘Šå•†å°†IPåœ°å€æˆ–å¹¿å‘Šé…ç½®æ–‡ä»¶é“¾æ¥åˆ°çœŸå®çš„äººèº«ä¸Šï¼Œå¯¹ç”¨æˆ·çš„åœ¨çº¿éšç§é€ æˆä¸¥é‡å¨èƒã€‚è¿™ç§æ³„éœ²ä¸æ˜¯é’ˆå¯¹è„¸è°±ç½‘çš„ï¼Œè€Œæ˜¯å½±å“æ‰€æœ‰å…è®¸å…¶å†…å®¹é€šè¿‡IFRAMSåµŒå…¥å…¶ä»–ç½‘é¡µçš„ç½‘ç«™ã€‚èƒ½åŠ›é©»ç•™åœ¨ä¸€ä¸ªCSSç‰¹æ€§çš„æµè§ˆå™¨å®ç°ä¸­ï¼Œå‘½åä¸ºâ€œæ··åˆæ··åˆæ¨¡å¼â€ç‰¹æ€§ï¼Œå®ƒå…è®¸Webå¼€å‘äººå‘˜å°†Webç»„ä»¶å †å åœ¨ä¸€èµ·ï¼Œå¹¶æ·»åŠ æ§åˆ¶å®ƒä»¬äº¤äº’æ–¹å¼çš„æ•ˆæœã€‚NDåœ¨ç…§ç‰‡ç¼–è¾‘è½¯ä»¶ï¼Œå¦‚PSå›¾è±¡å¤„ç†è½¯ä»¶ï¼ŒGIMPï¼ŒPr.netï¼Œå’Œå…¶ä»–ã€‚ç¤ºä¾‹æ··åˆæ¨¡å¼æ˜¯å åŠ ã€æš—åŒ–ã€æ·¡æ·¡ã€é¢œè‰²é—ªé¿ã€ä¹˜æ³•ã€åè½¬ç­‰ã€‚CSS3æ··åˆæ¨¡å¼ç‰¹å¾æ”¯æŒ16ç§æ··åˆæ¨¡å¼ï¼Œå¹¶ä¸”å®Œå…¨ä¾èµ–äºå°†ç”¨æˆ·è¯±éª—åˆ°æ¶æ„ç«™ç‚¹ï¼Œæ”»å‡»è€…å°†IFRAMSåµŒå…¥åˆ°å…¶ä»–ç«™ç‚¹ã€‚åœ¨ä»–çš„ä¾‹å­ä¸­ï¼ŒHabalovä¸ºè„¸è°±ç½‘çš„ä¸€ä¸ªç¤¾äº¤å°éƒ¨ä»¶åµŒå…¥äº†iFrAMSï¼Œä½†æ˜¯å…¶ä»–ç«™ç‚¹ä¹Ÿå®¹æ˜“å—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚è¿™äº›å±‚éƒ½æ˜¯1x1åƒç´ å¤§å°ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åªè¦†ç›–iFrAMEçš„ä¸€ä¸ªåƒç´ ã€‚Habalovè¯´ï¼Œæ ¹æ®æ¸²æŸ“æ•´ä¸ªå †æ ˆçš„æ—¶é—´æ‰€éœ€çš„æ—¶é—´ï¼Œæ”»å‡»è€…å¯ä»¥ç¡®å®šç”¨æˆ·å±å¹•ä¸Šæ˜¾ç¤ºçš„åƒç´ çš„é¢œè‰²ã€‚ç ”ç©¶äººå‘˜è¯´ï¼Œé€šè¿‡é€æ­¥ç§»åŠ¨DIVã€‚â€œæ‰«æâ€å †æ ˆåœ¨iFrAMEä¸Šï¼Œâ€œæœ‰å¯èƒ½ç¡®å®šiFrAMYçš„å†…å®¹ã€‚â€é€šå¸¸ï¼Œæ”»å‡»è€…å°†æ— æ³•è®¿é—®è¿™äº›IFRAMESçš„æ•°æ®ï¼Œå› ä¸ºåœ¨æµè§ˆå™¨å’Œè¿œç¨‹ç«™ç‚¹ä¸­å®ç°äº†å…è®¸åµŒå…¥å†…å®¹çš„åç‚¹å‡»å’Œå…¶ä»–å®‰å…¨æªæ–½ã€‚Habalovåœ¨ç½‘ä¸Šå‘å¸ƒäº†ä¸¤ä¸ªæ¼”ç¤ºï¼ˆå®é™…æ”»å‡»å¤§çº¦éœ€è¦20ç§’æ¥æ³„æ¼ç”¨æˆ·åï¼Œ500æ¯«ç§’æ¥æ£€æŸ¥ä»»ä½•å–œæ¬¢çš„/ä¸å–œæ¬¢çš„é¡µé¢çš„çŠ¶æ€ï¼‰ï¼Œå¹¶åœ¨å¤§çº¦20åˆ†é’Ÿå†…æ£€ç´¢ä¸€ä¸ªè„¸è°±ç½‘ç”¨æˆ·çš„åŒ–èº«ã€‚åœ¨å±å¹•ä¸Šç§»åŠ¨ï¼Œæˆ–è€…éšè—åœ¨å¦ä¸€ä¸ªå…ƒç´ ä¸‹ï¼ˆå‚è§ä¸‹é¢çš„æ¼”ç¤ºGIFï¼Œéšè—åœ¨çŒ«ç…§ç‰‡ä¸‹çš„æ”»å‡»ï¼‰ã€‚æ­¤å¤–ï¼Œé€šè¿‡è®©ç”¨æˆ·å¿™äºåœ¨çº¿æµ‹è¯•æˆ–æ›´é•¿çš„æ–‡ç« ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç½‘ç«™ä¸Šåœç•™å‡ åˆ†é’Ÿã€‚Habalovå‘è°·æ­Œå’ŒMozillaå·¥ç¨‹å¸ˆæŠ¥å‘Šäº†è¿™ä¸ªbugï¼Œä»–åœ¨Chrome 63å’ŒFirefox 60ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚Dé©¬å…‹æ–¯å¯ä»¥ç‹¬ç«‹åœ°å‘ç°å¹¶å‘è°·æ­ŒæŠ¥å‘Šè¿™ä¸ªé—®é¢˜ã€‚
Some of the recent additions to the Cascading Style Sheets (CSS) web standard are so powerful that a security researcher has abused them to deanonymize visitors to a demo site and reveal their Facebook usernames, avatars, and if they liked a particular web page of Facebook.Information leaked via this attack could aid some advertisers link IP addresses or advertising profiles to real-life persons, posing a serious threat to a user's online privacy.The leak isn't specific to Facebook but affects all sites which allow their content to be embedded on other web pages via iframes.The actual vulnerability resides in the browser implementation of a CSS feature named "The mix-blend-mode feature allows web developers to stack web components on top of each other and add effects for controlling to the way they interact.As the feature's name hints, these effects are inspired by the blend modes found in photo editing software like Photoshop, Gimp, Paint.net, and others. Example blend modes are Overlay, Darken, Lighten, Color Dodge, Multiply, Inverse, and others.The CSS3 mix-blend-mode feature supports 16 blend modes and is fully In The technique relies on luring users to a malicious site where the attacker embeds iframes to other sites. In his example, Habalov embedded iframes for one of Facebook's social widgets, but other sites are also susceptible to this issue.The attack consists of overlaying a huge stack of DIV layers with different blend modes on top of the iframe. These layers are all 1x1 pixel-sized, meaning they cover just one pixel of the iframe.Habalov says that depending on the time needed to render the entire stack of DIVs, an attacker can determine the color of that pixel shown on the user's screen.The researcher says that by gradually moving this DIV "scan" stack across the iframe, "it is possible to determine the iframe’s content."Normally, an attacker wouldn't be able to access the data of these iframes due to anti-clickjacking and other security measures implemented in browsers and in the remote sites that allow their content to be embedded via iframes.In two demos Habalov published online (The actual attack takes about 20 seconds to leak the username, 500 milliseconds to check the status of any liked/not-liked page, and around 20 minutes to retrieve a Facebook user's avatar.The attack is easy to disguise because the iframe can easily be moved offscreen, or hidden under another element (see demo gif below, hiding the attack under a cat photo). Furthermore, keeping a user on a site for minutes is also possible by keeping him busy with an online test or a longer article.Habalov reported the bug to Google and Mozilla engineers, who fixed the issue in Chrome 63 and Firefox 60."The bug was addressed by Besides Habalov, another researcher named Max May independently discovered and reported this issue to Google 